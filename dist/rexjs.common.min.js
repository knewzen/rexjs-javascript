/*!
 * RexJS v0.1.0
 * (c) 2017 nerdslabs
 * Released under the MIT License.
 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},asyncGenerator=function(){function e(e){this.value=e}function n(n){function t(r,i){try{var u=n[r](i),s=u.value;s instanceof e?Promise.resolve(s.value).then(function(e){t("next",e)},function(e){t("throw",e)}):o(u.done?"return":"normal",u.value)}catch(e){o("throw",e)}}function o(e,n){switch(e){case"return":r.resolve({value:n,done:!0});break;case"throw":r.reject(n);break;default:r.resolve({value:n,done:!1})}(r=r.next)?t(r.key,r.arg):i=null}var r,i;this._invoke=function(e,n){return new Promise(function(o,u){var s={key:e,arg:n,resolve:o,reject:u,next:null};i?i=i.next=s:(r=i=s,t(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new n(e.apply(this,arguments))}},await:function(n){return new e(n)}}}(),classCallCheck=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Module=function(){function e(n,t,o,r){classCallCheck(this,e),this._context=n,this._callback=r,this.worker=t,this.module=o,this.data={},this.bind()}return createClass(e,[{key:"bind",value:function(){var e=this;this.connection=new WebSocket(this._context._options.websocketUrl+"?worker="+this.worker+"&module="+this.module),this.connection.onopen=this._bind,this.connection.onclose=this._unbind,this.connection.onmessage=function(n){e._message(n)}}},{key:"unbind",value:function(){this.connection.close()}},{key:"_bind",value:function(){}},{key:"_message",value:function(e){var n=JSON.parse(e.data);"undefined"!==_typeof(n.error)?console.error("[RexJS] "+n.error):(this.data=n,this._callback(this.data))}},{key:"_unbind",value:function(){console.debug("[RexJS] worker: "+this.worker+", module: "+this.module+" disconnected")}}]),e}(),defaults={env:"production"},RexJS$1=function(){function e(n){if(classCallCheck(this,e),this._options=_extends({},defaults,n),"undefined"==("undefined"==typeof WebSocket?"undefined":_typeof(WebSocket)))throw"[RexJS] WebSocket in not avaible in this browser!";if("undefined"==_typeof(this._options.websocketUrl))throw"[RexJS] websocketUrl server url is not set in options!"}return createClass(e,[{key:"bindModule",value:function(e,n,t){if("undefined"!=(void 0===e?"undefined":_typeof(e))){if("undefined"!=(void 0===n?"undefined":_typeof(n)))return new Module(this,e,n,t);console.error("[RexJS] module not presented!")}else console.error("[RexJS] worker not presented!")}}]),e}();RexJS$1.version="0.1.0",module.exports=RexJS$1;